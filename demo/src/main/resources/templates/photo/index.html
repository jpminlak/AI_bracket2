<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ìŒì‹ ì‚¬ì§„ ë¶„ì„</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
<div class="container">
    <header class="header">
        <h1>AI ìŒì‹ ì‚¬ì§„ ë¶„ì„</h1>
        <p class="subtitle">ìŒì‹ ì‚¬ì§„ì„ ì—…ë¡œë“œí•˜ë©´ AIê°€ ìŒì‹ ì¢…ë¥˜ì™€ ì˜ì–‘ ì •ë³´ë¥¼ ìë™ìœ¼ë¡œ ë¶„ì„í•´ë“œë¦½ë‹ˆë‹¤.</p>
    </header>

    <div id="upload-screen" class="screen active">
        <div class="upload-area">
            <div class="upload-icons">
                <svg class="upload-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                    <polyline points="7,10 12,15 17,10"/>
                    <line x1="12" y1="15" x2="12" y2="3"/>
                </svg>
                <svg class="camera-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
                    <circle cx="12" cy="13" r="4"/>
                </svg>
            </div>
            <h2>ìŒì‹ ì‚¬ì§„ì„ ì—…ë¡œë“œí•˜ì„¸ìš”</h2>
            <button class="upload-btn" onclick="document.getElementById('file-upload').click()">
                <p>JPG, PNG íŒŒì¼ì„ ì„ íƒí•˜ê±°ë‚˜ ì—¬ê¸°ë¡œ ë“œë˜ê·¸í•˜ì—¬ ì—…ë¡œë“œ</p>
                <div class="tip">
                    <span class="tip-icon">ğŸ’¡</span>
                    <span>íŒ: ìŒì‹ì´ ì„ ëª…í•˜ê²Œ ë³´ì´ëŠ” ì‚¬ì§„ì¼ìˆ˜ë¡ ë” ì •í™•í•œ ë¶„ì„ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤</span>
                </div>
                <input type="file" id="file-upload" accept="image/*" hidden>
            </button>
        </div>
        <div id="loading" style="display: none; text-align: center; margin-top: 20px;">
            <p>ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...</p>
            <p style="font-size: 0.9em; color: #555;">
                <span id="loading-step-food" style="display: block;">ğŸ½ï¸ ìŒì‹ ì¢…ë¥˜ ì¸ì‹ ì¤‘...</span>
                <span id="loading-step-nutrient" style="display: block;">ğŸ“Š ì˜ì–‘ ì„±ë¶„ ë¶„ì„ ì¤‘...</span>
                <span id="loading-step-estimate" style="display: block;">â¬‡ï¸ ì„­ì·¨ëŸ‰ ì¶”ì • ì¤‘...</span>
            </p>
        </div>
        <p id="error-message" style="color: red; text-align: center; margin-top: 20px; display: none;"></p>
    </div>

    <div id="results-container" class="screen">
        <div class="result-content">
            <div class="result-header">
                <span class="success-icon">âœ…</span>
                <h2>ë¶„ì„ ì™„ë£Œ!</h2>
            </div>
            <div class="food-info-card">
                <div class="food-category">ì¸ì‹ëœ ìŒì‹</div>
                <h3 id="predicted-food" class="food-name"></h3>
                <img id="result-image" src="" alt="ë¶„ì„ ê²°ê³¼ ì´ë¯¸ì§€" style="max-width: 100%; height: auto; border-radius: 15px; display: none;">
                <div class="serving-info">
                    <span>ì¶”ì • ì„­ì·¨ëŸ‰: 1ì¸ë¶„ (ì•½ 250g)</span>
                </div>
                <div class="confidence">
                    <span>ë¶„ì„ ì‹ ë¢°ë„: <strong id="confidence"></strong></span>
                </div>
            </div>
            <div class="nutrition-grid">
                <div class="nutrition-card calories">
                    <div class="nutrition-icon">ğŸ”¥</div>
                    <div class="nutrition-label">ì¹¼ë¡œë¦¬</div>
                    <div id="energy" class="nutrition-value"></div>
                    <div class="nutrition-unit">kcal</div>
                </div>
                <div class="nutrition-card carbs">
                    <div class="nutrition-icon">âšª</div>
                    <div class="nutrition-label">íƒ„ìˆ˜í™”ë¬¼</div>
                    <div id="carbohydrate" class="nutrition-value"></div>
                    <div class="nutrition-unit">g</div>
                </div>
                <div class="nutrition-card protein">
                    <div class="nutrition-icon">ğŸ¥©</div>
                    <div class="nutrition-label">ë‹¨ë°±ì§ˆ</div>
                    <div id="protein" class="nutrition-value"></div>
                    <div class="nutrition-unit">g</div>
                </div>
                <div class="nutrition-card fat">
                    <div class="nutrition-icon">ğŸ§ˆ</div>
                    <div class="nutrition-label">ì§€ë°©</div>
                    <div id="fat" class="nutrition-value"></div>
                    <div class="nutrition-unit">g</div>
                </div>
            </div>
            <div class="analysis-details">
                <div class="details-header">
                    <span class="bulb-icon">ğŸ’¡</span>
                    <h4>ì˜ì–‘ ë¶„ì„ ê²°ê³¼</h4>
                </div>
                <p>
                    ë¶„ì„ ê²°ê³¼ëŠ” ìŒì‹ì˜ ì¢…ë¥˜, ì–‘, ì¡°ë¦¬ë²•ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    ì •í™•í•œ ì˜ì–‘ ì •ë³´ëŠ” ì „ë¬¸ì ì¸ ì‹ë‹¨ ê´€ë¦¬ ë„êµ¬ë¥¼ í™œìš©í•˜ì‹œëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.
                </p>
            </div>
            <div class="action-buttons">
                <button id="reset-button" class="new-analysis-btn">ğŸ”„ ìƒˆë¡œìš´ ë¶„ì„ ì‹œì‘</button>
                <button class="add-to-meal-btn">ğŸ“ ì‹ë‹¨ì— ì¶”ê°€</button>
            </div>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // ëª¨ë“  í™”ë©´ ìš”ì†Œì™€ ë²„íŠ¼ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
            const uploadScreen = document.getElementById('upload-screen');
            const resultsContainer = document.getElementById('results-container');
            const fileInput = document.getElementById('file-upload');
            const loading = document.getElementById('loading');
            const resultImage = document.getElementById('result-image');
            const errorMessage = document.getElementById('error-message');
            const resetButton = document.getElementById('reset-button');

            // ë™ì  ë°ì´í„°ë¥¼ ìœ„í•œ ìš”ì†Œë“¤ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
            const predictedFoodElem = document.getElementById('predicted-food');
            const confidenceElem = document.getElementById('confidence');
            const energyElem = document.getElementById('energy');
            const carbohydrateElem = document.getElementById('carbohydrate');
            const proteinElem = document.getElementById('protein');
            const fatElem = document.getElementById('fat');

            let uploadedFile = null;
            let uploadedFileUrl = null;
            const API_URL = 'http://localhost:8000/upload';

            // í™”ë©´ ì „í™˜ì„ ë‹´ë‹¹í•˜ëŠ” í•¨ìˆ˜
            const showScreen = (screenToShow) => {
                uploadScreen.style.display = 'none';
                resultsContainer.style.display = 'none';
                screenToShow.style.display = 'block';
            };

            // ë¶„ì„ ë¡œì§ì„ í•¨ìˆ˜ë¡œ ë¶„ë¦¬í•˜ì—¬ ì¬ì‚¬ìš©ì„±ì„ ë†’ì…ë‹ˆë‹¤.
            async function startAnalysis() {
                if (!uploadedFile) {
                    errorMessage.textContent = 'ì´ë¯¸ì§€ë¥¼ ë¨¼ì € ì—…ë¡œë“œí•´ì£¼ì„¸ìš”';
                    errorMessage.style.display = 'block';
                    return;
                }

                loading.style.display = 'flex';
                errorMessage.style.display = 'none';
                showScreen(uploadScreen); // ë¡œë”© í™”ë©´ì´ 'upload-screen' ë‚´ë¶€ì— ìˆìœ¼ë¯€ë¡œ ì´ í™”ë©´ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.

                const formData = new FormData();
                formData.append('foodFile', uploadedFile);

                try {
                    const response = await fetch(API_URL, { method: 'POST', body: formData });
                    if (!response.ok) throw new Error(`HTTP ì˜¤ë¥˜ ${response.status}`);
                    const data = await response.json();

                    showResults(data.food_name, data.confidence, data.nutrition_info, uploadedFileUrl);

                } catch (e) {
                    console.error(e);
                    errorMessage.textContent = `ë¶„ì„ ì‹¤íŒ¨: ${e.message}`;
                    errorMessage.style.display = 'block';

                } finally {
                    loading.style.display = 'none';
                }
            }

            // íŒŒì¼ ì…ë ¥(input) ë³€ê²½ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ: íŒŒì¼ ì„ íƒ ì‹œ ì¦‰ì‹œ ë¶„ì„ ì‹œì‘
            fileInput.addEventListener('change', e => {
                uploadedFile = e.target.files[0];
                if (uploadedFile) {
                    const reader = new FileReader();
                    reader.onload = e => {
                        uploadedFileUrl = e.target.result;
                        // ì´ë¯¸ì§€ í”„ë¦¬ë·°ëŠ” ë¶„ì„ ê²°ê³¼ í™”ë©´ì—ì„œ ë³´ì—¬ì£¼ë¯€ë¡œ ì—¬ê¸°ì„œ ë”°ë¡œ í‘œì‹œí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
                        // ë§Œì•½ ì—…ë¡œë“œ í›„ ë¶„ì„ ì „ í™”ë©´ì´ í•„ìš”í•˜ë‹¤ë©´ ë³„ë„ë¡œ ë¡œì§ì„ ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤.
                        startAnalysis();
                    };
                    reader.readAsDataURL(uploadedFile);
                }
            });

            // 'ìƒˆë¡œìš´ ë¶„ì„ ì‹œì‘' ë²„íŠ¼ì— ëŒ€í•œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            resetButton.addEventListener('click', () => {
                fileInput.value = ''; // input íŒŒì¼ ì´ˆê¸°í™”
                uploadedFile = null;
                uploadedFileUrl = null;
                showScreen(uploadScreen);
                errorMessage.style.display = 'none';
            });

            function showResults(food, confidence, nutrition, imageSrc) {
                resultImage.src = imageSrc;
                resultImage.style.display = 'block'; // ê²°ê³¼ë¥¼ ë³´ì—¬ì¤„ ë•Œ ì´ë¯¸ì§€ë„ ê°™ì´ ë³´ì´ê²Œ í•©ë‹ˆë‹¤.

                predictedFoodElem.textContent = food;
                confidenceElem.textContent = confidence ? `${(confidence * 100).toFixed(2)}%` : 'N/A';
                const safeNutrition = nutrition || {};
                energyElem.textContent = safeNutrition.calories ?? 'N/A';
                carbohydrateElem.textContent = safeNutrition.carbohydrates ?? 'N/A';
                proteinElem.textContent = safeNutrition.protein ?? 'N/A';
                fatElem.textContent = safeNutrition.fat ?? 'N/A';

                showScreen(resultsContainer);
            }
        });
    </script>

    <style>
        * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        min-height: 100vh;
        background-color: #fff;
        line-height: 1.6;
    }

    .container {
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
    }


    .header {
        text-align: center;
        margin-bottom: 40px;
        padding: 40px 0;
    }

    .header h1 {
        font-size: 2.5rem;
        font-weight: 700;
        color: #2c3e50;
        margin-bottom: 10px;
    }

    .subtitle {
        font-size: 1.1rem;
        color: #7f8c8d;
        max-width: 600px;
        margin: 0 auto;
    }

    .screen {
        display: none;
        animation: fadeIn 0.5s ease-in-out;
    }

    .screen.active {
        display: block;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
    .food-info-card {
        /* ê¸°ì¡´ ìŠ¤íƒ€ì¼ */
        background: linear-gradient(135deg, #e8f5e8 0%, #f0f8f0 100%);
        border-radius: 15px;
        padding: 30px;
        margin-bottom: 30px;

        /* ì´ ì¤„ì„ ì¶”ê°€í•˜ì—¬ ì´ë¯¸ì§€ë¥¼ ê°€ìš´ë°ë¡œ ì •ë ¬í•©ë‹ˆë‹¤. */
        text-align: center;
    }
    /* ï¿½ë‚…ì¤ˆï¿½ï¿½ ï¿½ë¶¾ãˆƒ */
    .upload-area {
        background: white;
        border: 2px dashed #bdc3c7;
        border-radius: 20px;
        padding: 60px 40px;
        text-align: center;
        transition: all 0.3s ease;
        cursor: pointer;
    }

    .upload-area:hover {
        border-color: #white;S
        background: #f8f9fa;
    }

    .upload-icons {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-bottom: 30px;
    }

    .upload-icon, .camera-icon {
        width: 60px;
        height: 60px;
        color: #95a5a6;
    }

    .upload-area h2 {
        font-size: 1.8rem;
        color: #2c3e50;
        margin-bottom: 10px;
    }

    .upload-area p {
        color: #7f8c8d;
        margin-bottom: 30px;
    }

    .tip {
        background: #e3f2fd;
        border-radius: 10px;
        padding: 15px;
        margin: 20px 0;
        display: flex;
        align-items: center;
        gap: 10px;
        color: #1976d2;
    }

    .tip-icon {
        font-size: 1.2rem;
    }

    .upload-btn {
        background: #fff;
        border: none;
        padding: 15px 30px;
        border-radius: 10px;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
    }



    /* ï¿½ë‚…ì¤ˆï¿½ï¿½ ï¿½ê¾¨ì¦º ï¿½ë¶¾ãˆƒ */
    .uploaded-content {
        background: #fff;
        border-radius: 20px;
        padding: 40px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }

    .uploaded-header {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 15px;
        margin-bottom: 30px;
    }

    .fork-icon {
        width: 30px;
        height: 30px;
        color: #3498db;
    }

    .uploaded-header h2 {
        color: #white;
        font-size: 1.8rem;
    }

    .image-preview {
        margin: 30px 0;
        text-align: center;
    }

    .image-preview img {
        max-width: 100%;
        max-height: 300px;
        border-radius: 15px;
        box-shadow: 0 5px 20px rgba(0,0,0,0.1);
    }

    .upload-status {
        text-align: center;
        color: #7f8c8d;
        margin-bottom: 30px;
    }

    .action-buttons {
        display: flex;
        gap: 15px;
        justify-content: center;
        flex-wrap: wrap;
    }

    .analyze-btn {
        background: #3498db;
        color: white;
        border: none;
        padding: 15px 30px;
        border-radius: 10px;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .analyze-btn:hover {
        background: #2980b9;
        transform: translateY(-2px);
    }

    .select-another-btn {
        background: #ecf0f1;
        color: #7f8c8d;
        border: none;
        padding: 15px 30px;
        border-radius: 10px;
        font-size: 1.1rem;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .select-another-btn:hover {
        background: #d5dbdb;
    }

    /* éºê¾©ê½ å¯ƒê³Œë‚µ ï¿½ë¶¾ãˆƒ */
    .result-content {
        background: white;
        border-radius: 20px;
        padding: 40px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }

    .result-header {
        text-align: center;
        margin-bottom: 30px;
    }

    .success-icon {
        font-size: 2rem;
        margin-bottom: 10px;
        display: block;
    }

    .result-header h2 {
        color: #27ae60;
        font-size: 1.8rem;
    }

    /* ï¿½ëš¯ë–‡ ï¿½ëº£ë‚« ç§»ëŒ€ë±¶ */
    .food-info-card {
        background: linear-gradient(135deg, #e8f5e8 0%, #f0f8f0 100%);
        border-radius: 15px;
        padding: 30px;
        margin-bottom: 30px;
        text-align: center;
    }

    .food-category {
        color: #7f8c8d;
        font-size: 0.9rem;
        margin-bottom: 10px;
    }

    .food-name {
        font-size: 2.2rem;
        color: #2c3e50;
        font-weight: 700;
        margin-bottom: 15px;
    }

    .serving-info {
        color: #7f8c8d;
        margin-bottom: 10px;
    }

    .confidence {
        color: #27ae60;
        font-weight: 600;
    }

    /* ï¿½ê³¸ë¼‡ ï¿½ëº£ë‚« æ´¹ëªƒâ”ï¿½ï¿½ */
    .nutrition-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .nutrition-card {
        background: white;
        border-radius: 15px;
        padding: 25px;
        text-align: center;
        box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        transition: transform 0.3s ease;
    }

    .nutrition-card:hover {
        transform: translateY(-5px);
    }

    .nutrition-card.calories {
        border-left: 4px solid #e74c3c;
    }

    .nutrition-card.carbs {
        border-left: 4px solid #95a5a6;
    }

    .nutrition-card.protein {
        border-left: 4px solid #e67e22;
    }

    .nutrition-card.fat {
        border-left: 4px solid #f39c12;
    }

    .nutrition-icon {
        font-size: 1.5rem;
        margin-bottom: 10px;
    }

    .nutrition-label {
        color: #7f8c8d;
        font-size: 0.9rem;
        margin-bottom: 5px;
    }

    .nutrition-value {
        font-size: 2rem;
        font-weight: 700;
        color: #2c3e50;
        margin-bottom: 5px;
    }

    .nutrition-card.calories .nutrition-value {
        color: #e74c3c;
    }

    .nutrition-card.carbs .nutrition-value {
        color: #95a5a6;
    }

    .nutrition-card.protein .nutrition-value {
        color: #e67e22;
    }

    .nutrition-card.fat .nutrition-value {
        color: #f39c12;
    }

    .nutrition-unit {
        color: #7f8c8d;
        font-size: 0.9rem;
    }

    /* éºê¾©ê½ ï¿½ëªƒï¿½ï¿½Ñ‹ë¹† */
    .analysis-details {
        background: #f8f9fa;
        border-radius: 15px;
        padding: 25px;
        margin-bottom: 30px;
    }

    .details-header {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 15px;
    }

    .bulb-icon {
        font-size: 1.2rem;
    }

    .details-header h4 {
        color: #2c3e50;
        font-size: 1.2rem;
    }

    .details-content p {
        margin-bottom: 15px;
        color: #555;
    }

    .details-content ul {
        list-style: none;
        padding-left: 0;
    }

    .details-content li {
        color: #555;
        margin-bottom: 8px;
        padding-left: 20px;
        position: relative;
    }

    .details-content li::before {
        content: "ï¿½ï¿½";
        color: #3498db;
        font-weight: bold;
        position: absolute;
        left: 0;
    }

    /* ï¿½â‰ªë€¡ è¸°ê¾ªë“‰ï¿½ï¿½ */
    .new-analysis-btn {
        background: #3498db;
        color: white;
        border: none;
        padding: 15px 30px;
        border-radius: 10px;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-right: 15px;
    }

    .new-analysis-btn:hover {
        background: #2980b9;
        transform: translateY(-2px);
    }

    .add-to-meal-btn {
        background: #ecf0f1;
        color: #7f8c8d;
        border: none;
        padding: 15px 30px;
        border-radius: 10px;
        font-size: 1.1rem;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .add-to-meal-btn:hover {
        background: #d5dbdb;
    }

    /* è«›ì„ì“³ï¿½ï¿½ ï¿½ë¶¿ì˜„ï¿½ï¿½ */
    @media (max-width: 768px) {
        .container {
            padding: 15px;
        }

        .header h1 {
            font-size: 2rem;
        }

        .upload-area {
            padding: 40px 20px;
        }

        .uploaded-content,
        .result-content {
            padding: 25px;
        }

        .nutrition-grid {
            grid-template-columns: repeat(2, 1fr);
        }

        .action-buttons {
            flex-direction: column;
        }

        .action-buttons button {
            width: 100%;
            margin-bottom: 10px;
        }
    }

    </style>
</div>

</body>
</html>
